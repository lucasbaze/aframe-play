<!DOCTYPE html>
<head>
    <!-- A Frame -->
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <!-- Physics -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <script>
        $ = sel => document.querySelector(sel);
        $$ = sel => document.querySelectorAll(sel);
        on = (elem, type, hand) => elem.addEventListener(type, hand);
    </script>
</head>

<body>
    <a-scene stats>
        <a-entity
            id="ball"
            color="green"
            position="0 1 -4"
            geometry="primitive:sphere; radius:0.5"
            dynamic-body
        ></a-entity>
        <a-plane
            rotation="-90 0 0"
            color="orange"
            width="100"
            height="100"
            static-body
        ></a-plane>
        <a-entity camera look-controls wasd-controls position="0 1.5 0">
            <a-cursor></a-cursor>
            <a-text
                id="score"
                value="Score"
                position="-0.2 -0.5 -1"
                color="red"
                width="5"
                anchor="left"
            ></a-text>
            <a-entity position="0 0 -3" id="weapon">
                <a-box
                    height="0.5"
                    width="0.25"
                    depth="3"
                    color="blue"
                    static-body
                ></a-box>
            </a-entity>
        </a-entity>
    </a-scene>
    <script>
        let hit = false;
        let resetId = 0;
        const resetBall = () => {
            clearTimeout(resetId);
            $('#ball').body.position.set(0, 0.6, -4);
            $('#ball').body.velocity.set(0, 5, 0);
            $('#ball').body.angularVelocity.set(0, 0, 0);
            hit = false;
            resetId = setTimeout(resetBall, 6000);
        };

        let score = 0;
        hit = false;
        resetId = 0;
        on($('#weapon'), 'collide', e => {
            const ball = $('#ball');
            if (e.detail.body.id === ball.body.id && !hit) {
                hit = true;
                score = score + 1;
                clearTimeout(resetId);
                resetId = setTimeout(resetBall, 2000);
                $('#score').setAttribute('text', 'value', 'Score ' + score);
            }
        });

        setTimeout(resetBall, 3000);
    </script>
</body>
